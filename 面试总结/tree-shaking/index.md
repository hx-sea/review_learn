# Tree-shaking 原理

- 利用 ES Moduel 做静态分析，然后分析 ast 语法树，对每个模块维护了一个作用域，收集模块内部使用的变量，然后分析作用域，将 import 未使用的模块删除，最后递归处理文件

* Commonjs 模块化管理方案中，导入导出行为是高度动态，难以预测的，

```js
if (process.env.NODE_ENV === 'development') {
	require('./bar');
	exports.foo = 'foo';
}
```

而 ESM 从规范规避了这一层行为，它要求所有的导入导出语句只能出现在模块顶层，所以 ESM 下模块之间的依赖关系是高度确认的，与运行状态无关，编译工具只需要对 ESM 模块做静态分析，就可以从代码字面量推出哪些模块未曾被其他模块使用
